



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A R documentation website.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Data Analysis in R, the data.table Way - ugo_r_doc</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#documentation" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="ugo_r_doc" class="md-header-nav__button md-logo">
          
            <i class="md-icon">layers</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                ugo_r_doc
              </span>
              <span class="md-header-nav__topic">
                Data Analysis in R, the data.table Way
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ugoproto/ugo_r_doc.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ugo_r_doc
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="ugo_r_doc" class="md-nav__button md-logo">
      
        <i class="md-icon">layers</i>
      
    </a>
    ugo_r_doc
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ugoproto/ugo_r_doc.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ugo_r_doc
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Cheat Sheets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Cheat Sheets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_cs/" title="Basics Cheat Sheets" class="md-nav__link">
      Basics Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../specializations_cs/" title="Specializations Cheat Sheets" class="md-nav__link">
      Specializations Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../visualization_cs/" title="Visualization Cheat Sheets" class="md-nav__link">
      Visualization Cheat Sheets
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Code and Vade Mecum
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Code and Vade Mecum
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../frequentist_bayesian/" title="Frequentist vs. Bayesian" class="md-nav__link">
      Frequentist vs. Bayesian
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../intermediate_r/" title="Intermediate R" class="md-nav__link">
      Intermediate R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../intermediate_r_the_apply_family/" title="Intermediate R - The apply Family" class="md-nav__link">
      Intermediate R - The apply Family
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Data Wrangling Snippets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Data Wrangling Snippets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../io_snippets_cleaning/" title="I/O Snippets & Cleaning" class="md-nav__link">
      I/O Snippets & Cleaning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reading_data_into_r_with_readr/" title="Reading Data into R with readr" class="md-nav__link">
      Reading Data into R with readr
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Data Analysis in R, the data.table Way
      </label>
    
    <a href="./" title="Data Analysis in R, the data.table Way" class="md-nav__link md-nav__link--active">
      Data Analysis in R, the data.table Way
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#documentation" title="Documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-novice" title="data.table novice" class="md-nav__link">
    data.table novice
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-and-subset-a-datatable" title="Create and subset a data.table" class="md-nav__link">
    Create and subset a data.table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-to-know-a-datatable" title="Getting to know a data.table" class="md-nav__link">
    Getting to know a data.table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subsetting-data-tables" title="Subsetting data tables" class="md-nav__link">
    Subsetting data tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-by-basics" title="The by basics" class="md-nav__link">
    The by basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-n-and-by" title="Using .N and by" class="md-nav__link">
    Using .N and by
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-multiple-numbers-in-j" title="Return multiple numbers in j" class="md-nav__link">
    Return multiple numbers in j
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-yeoman" title="data.table yeoman" class="md-nav__link">
    data.table yeoman
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chaining-the-basics" title="Chaining, the basics" class="md-nav__link">
    Chaining, the basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programming-time-vs-readability" title="Programming time vs readability" class="md-nav__link">
    Programming time vs readability
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introducing-sdcols" title="Introducing .SDcols" class="md-nav__link">
    Introducing .SDcols
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixing-it-together-lapply-sd-sdcols-and-n" title="Mixing it together: lapply, .SD, SDcols and .N" class="md-nav__link">
    Mixing it together: lapply, .SD, SDcols and .N
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-updating-and-removing-columns" title="Adding, updating, and removing columns" class="md-nav__link">
    Adding, updating, and removing columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-functional-form" title="The functional form" class="md-nav__link">
    The functional form
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ready-set-go" title="Ready, set, go!" class="md-nav__link">
    Ready, set, go!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-expert" title="data.table expert" class="md-nav__link">
    data.table expert
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selecting-rows-the-datatable-way" title="Selecting rows the data.table way" class="md-nav__link">
    Selecting rows the data.table way
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-columns-and-adapting-your-column-names" title="Removing columns and adapting your column names" class="md-nav__link">
    Removing columns and adapting your column names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-automatic-indexing" title="Understanding automatic indexing" class="md-nav__link">
    Understanding automatic indexing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecting-groups-or-parts-of-groups" title="Selecting groups or parts of groups" class="md-nav__link">
    Selecting groups or parts of groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rolling-joins" title="Rolling joins" class="md-nav__link">
    Rolling joins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data_manipulation_in_r_with_dplyr/" title="Data Manipulation in R with dplyr" class="md-nav__link">
      Data Manipulation in R with dplyr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data_wrangling/" title="Data Wrangling" class="md-nav__link">
      Data Wrangling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Packages
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Packages
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../googlevis/" title="googleVis (embed HTML plots)" class="md-nav__link">
      googleVis (embed HTML plots)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gganimate/" title="gganimate" class="md-nav__link">
      gganimate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fast_and_frugal_decision_trees_in_r_with_fftrees/" title="Fast-and-Frugal Decision Trees" class="md-nav__link">
      Fast-and-Frugal Decision Trees
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../big_data_analysis_with_revolution_r_enterprise/" title="Big Data Analysis with Revolution R Enterprise" class="md-nav__link">
      Big Data Analysis with Revolution R Enterprise
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../time_series_in_r_the_power_of_xts_and_zoo/" title="Time Series in R, The Power of xts and zoo" class="md-nav__link">
      Time Series in R, The Power of xts and zoo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Plot Snippets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Plot Snippets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../plot_snippets_basics/" title="Plot Snippets for Exploratory (and some Explanatory) Analyses" class="md-nav__link">
      Plot Snippets for Exploratory (and some Explanatory) Analyses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../plot_snippets_ggplot2/" title="Plot Snippets - ggplot2" class="md-nav__link">
      Plot Snippets - ggplot2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../plot_snippets_ggvis/" title="Plot Snippets - ggvis" class="md-nav__link">
      Plot Snippets - ggvis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../plot_snippets_colours/" title="Plot Snippets - Colours" class="md-nav__link">
      Plot Snippets - Colours
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      RStudio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        RStudio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../working_with_rstudio_ide/" title="Working with the RStudio IDE" class="md-nav__link">
      Working with the RStudio IDE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Tables and Figures
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Tables and Figures
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tables/" title="Tables" class="md-nav__link">
      Tables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../embedding/" title="Embedding HTML into HTML" class="md-nav__link">
      Embedding HTML into HTML
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../embedding_2/" title="Embedding Rmd into Rmd" class="md-nav__link">
      Embedding Rmd into Rmd
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      A Hands-on Introduction to Statistics with R
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        A Hands-on Introduction to Statistics with R
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../a_hands-on_introduction_to_statistics_with_r_course_one_introduction/" title="Statistics with R, Course One, Introduction" class="md-nav__link">
      Statistics with R, Course One, Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a_hands-on_introduction_to_statistics_with_r_course_two_student_s_t-test/" title="Statistics with R, Course Two, Student's t-test" class="md-nav__link">
      Statistics with R, Course Two, Student's t-test
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a_hands-on_introduction_to_statistics_with_r_course_three_analysis_of_variance/" title="Statistics with R, Course Three, Analysis of Variance" class="md-nav__link">
      Statistics with R, Course Three, Analysis of Variance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a_hands-on_introduction_to_statistics_with_r_course_four_repeated_measures_anova/" title="Statistics with R, Course Four, Repeated Measures ANOVA" class="md-nav__link">
      Statistics with R, Course Four, Repeated Measures ANOVA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a_hands-on_introduction_to_statistics_with_r_course_five_correlation_and_regression/" title="Statistics with R, Course Five, Correlation and Regression" class="md-nav__link">
      Statistics with R, Course Five, Correlation and Regression
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a_hands-on_introduction_to_statistics_with_r_course_six_multiple_regression/" title="Statistics with R, Course Six, Multiple Regression" class="md-nav__link">
      Statistics with R, Course Six, Multiple Regression
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a_hands-on_introduction_to_statistics_with_r_course_seven_moderation_and_mediation/" title="Statistics with R, Course Seven, Moderation and Mediation" class="md-nav__link">
      Statistics with R, Course Seven, Moderation and Mediation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a_hands-on_introduction_to_statistics_with_r_notes/" title="Statistics with R, Notes" class="md-nav__link">
      Statistics with R, Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#documentation" title="Documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-novice" title="data.table novice" class="md-nav__link">
    data.table novice
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-and-subset-a-datatable" title="Create and subset a data.table" class="md-nav__link">
    Create and subset a data.table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-to-know-a-datatable" title="Getting to know a data.table" class="md-nav__link">
    Getting to know a data.table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subsetting-data-tables" title="Subsetting data tables" class="md-nav__link">
    Subsetting data tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-by-basics" title="The by basics" class="md-nav__link">
    The by basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-n-and-by" title="Using .N and by" class="md-nav__link">
    Using .N and by
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-multiple-numbers-in-j" title="Return multiple numbers in j" class="md-nav__link">
    Return multiple numbers in j
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-yeoman" title="data.table yeoman" class="md-nav__link">
    data.table yeoman
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chaining-the-basics" title="Chaining, the basics" class="md-nav__link">
    Chaining, the basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programming-time-vs-readability" title="Programming time vs readability" class="md-nav__link">
    Programming time vs readability
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introducing-sdcols" title="Introducing .SDcols" class="md-nav__link">
    Introducing .SDcols
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixing-it-together-lapply-sd-sdcols-and-n" title="Mixing it together: lapply, .SD, SDcols and .N" class="md-nav__link">
    Mixing it together: lapply, .SD, SDcols and .N
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-updating-and-removing-columns" title="Adding, updating, and removing columns" class="md-nav__link">
    Adding, updating, and removing columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-functional-form" title="The functional form" class="md-nav__link">
    The functional form
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ready-set-go" title="Ready, set, go!" class="md-nav__link">
    Ready, set, go!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-expert" title="data.table expert" class="md-nav__link">
    data.table expert
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selecting-rows-the-datatable-way" title="Selecting rows the data.table way" class="md-nav__link">
    Selecting rows the data.table way
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-columns-and-adapting-your-column-names" title="Removing columns and adapting your column names" class="md-nav__link">
    Removing columns and adapting your column names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-automatic-indexing" title="Understanding automatic indexing" class="md-nav__link">
    Understanding automatic indexing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecting-groups-or-parts-of-groups" title="Selecting groups or parts of groups" class="md-nav__link">
    Selecting groups or parts of groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rolling-joins" title="Rolling joins" class="md-nav__link">
    Rolling joins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ugoproto/ugo_r_doc.git/edit/master/docs/data_analysis_in_r_the_data_table_way.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Data Analysis in R, the data.table Way</h1>
                
                <!--
-   [Documentation](#documentation)
-   [1, `data.table` novice](#data.table-novice)
    -   [Create and subset a
        `data.table`](#create-and-subset-a-data.table)
    -   [Getting to know a `data.table`](#getting-to-know-a-data.table)
    -   [Subsetting data tables](#subsetting-data-tables)
    -   [The `by` basics](#the-by-basics)
    -   [Using `.N` and `by`](#using-.n-and-by)
    -   [Return multiple numbers in `j`](#return-multiple-numbers-in-j)
-   [2, `data.table` yeoman](#data.table-yeoman)
    -   [Chaining, the basics](#chaining-the-basics)
    -   [Programming time vs
        readability](#programming-time-vs-readability)
    -   [Introducing `.SDcols`](#introducing-.sdcols)
    -   [Mixing it together: `lapply`, `.SD`, `SDcols` and
        `.N`](#mixing-it-together-lapply-.sd-sdcols-and-.n)
    -   [Adding, updating, and removing
        columns](#adding-updating-and-removing-columns)
    -   [The functional form](#the-functional-form)
    -   [Ready, `set`, go!](#ready-set-go)
-   [3, `data.table` expert](#data.table-expert)
    -   [Selecting rows the `data.table`
        way](#selecting-rows-the-data.table-way)
    -   [Removing columns and adapting your column
        names](#removing-columns-and-adapting-your-column-names)
    -   [Understanding automatic
        indexing](#understanding-automatic-indexing)
    -   [Selecting groups or parts of
        groups](#selecting-groups-or-parts-of-groups)
    -   [Rolling joins](#rolling-joins)
-->

<hr />
<p><strong>Foreword</strong></p>
<ul>
<li>Output options: the &lsquo;tango&rsquo; syntax and the &lsquo;readable&rsquo; theme.</li>
<li>Snippets and results.</li>
</ul>
<hr />
<h2 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h2>
<p><code class="codehilite">data.table</code></p>
<ul>
<li>Extension of <code class="codehilite">data.frame</code>.</li>
<li>Fast aggregation of large data (e.g. 100GB in RAM), fast ordered     joins, fast add/modify/delete of columns by group using no copies at     all, list columns, a fast friendly file reader and parallel file writer. Offers a natural and flexible syntax, for faster development.</li>
</ul>
<p><code class="codehilite">dplyr</code></p>
<ul>
<li>A fast, consistent tool for working with data frame like objects, both in memory and out of memory.</li>
<li>Pipelines.</li>
</ul>
<p><code class="codehilite">tidyr</code></p>
<ul>
<li>An evolution of &lsquo;reshape2&rsquo;. It&rsquo;s designed specifically for data tidying (not general reshaping or aggregating) and works well with dplyr data pipelines.</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">package</th>
<th align="left">'narrower'</th>
<th align="left">'wider'</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>tidyr</code></td>
<td align="left">gather</td>
<td align="left">spread</td>
</tr>
<tr class="even">
<td align="left"><code>reshape2</code></td>
<td align="left">melt</td>
<td align="left">cast</td>
</tr>
<tr class="odd">
<td align="left">spreadsheets</td>
<td align="left">unpivot</td>
<td align="left">pivot</td>
</tr>
<tr class="even">
<td align="left">databases</td>
<td align="left">fold</td>
<td align="left">unfold</td>
</tr>
</tbody>
</table>

<h2 id="datatable-novice"><code class="codehilite">data.table</code> novice<a class="headerlink" href="#datatable-novice" title="Permanent link">&para;</a></h2>
<p>Find out more with <code class="codehilite">?data.table</code>.</p>
<h3 id="create-and-subset-a-datatable">Create and subset a <code class="codehilite">data.table</code><a class="headerlink" href="#create-and-subset-a-datatable" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># The data.table package</span>
<span class="nf">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span>

<span class="c1"># Create my_first_data_table</span>
<span class="n">my_first_data_table</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">))</span>

<span class="c1"># Create a data.table using recycling</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">))</span>

<span class="c1"># Print the third row to the console</span>
<span class="n">DT[3</span><span class="p">,</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: 1 C
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print the second and third row to the console, but do not commas</span>
<span class="n">DT[2</span><span class="o">:</span><span class="m">3</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: 2 B
## 2: 1 C
</pre></div>
</td></tr></table>

<h3 id="getting-to-know-a-datatable">Getting to know a <code class="codehilite">data.table</code><a class="headerlink" href="#getting-to-know-a-datatable" title="Permanent link">&para;</a></h3>
<p>Like <code class="codehilite">head</code>, <code class="codehilite">tail</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print the penultimate row of DT using .N</span>
<span class="n">DT[.N</span> <span class="o">-</span> <span class="m">1</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: 1 C
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print the column names of DT, and number of rows and number of columns</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## [1] &quot;a&quot; &quot;b&quot;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">dim</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## [1] 4 2
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Select row 2 twice and row 3, returning a data.table with three rows where row 2 is a duplicate of row 1.</span>
<span class="n">DT</span><span class="nf">[c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: 2 B
## 2: 2 B
## 3: 1 C
</pre></div>
</td></tr></table>

<p><code class="codehilite">DT</code> is a data.table/data.frame, but <code class="codehilite">DT[ , B]</code> is a vector; <code class="codehilite">DT[ , .(B)]</code> is a subsetted data.table.</p>
<h3 id="subsetting-data-tables">Subsetting data tables<a class="headerlink" href="#subsetting-data-tables" title="Permanent link">&para;</a></h3>
<p><code class="codehilite">DT[i, j, by]</code> means take <code class="codehilite">DT</code>, subset rows using <code class="codehilite">i</code>, then calculate <code class="codehilite">j</code> grouped by <code class="codehilite">by</code>. You can wrap <code class="codehilite">j</code> with <code class="codehilite">.()</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">)</span>
<span class="n">C</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>

<span class="c1"># Subset rows 1 and 3, and columns B and C</span>
<span class="n">DT</span><span class="nf">[c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="p">,</span><span class="n">.(B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    B C
## 1: a 6
## 2: c 8
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Assign to ans the correct value</span>
<span class="n">ans</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">DT[</span><span class="p">,</span> <span class="n">.(B</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C</span><span class="p">)</span><span class="n">]</span><span class="p">)</span>

<span class="c1"># Fill in the blanks such that ans2 equals target</span>
<span class="c1">#target &lt;- data.table(B = c(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;),  val = as.integer(c(6:10, 1:5)))</span>
<span class="n">ans2</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">DT[</span><span class="p">,</span> <span class="n">.(B</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="nf">as.integer</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)))</span><span class="n">]</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3 id="the-by-basics">The <code class="codehilite">by</code> basics<a class="headerlink" href="#the-by-basics" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># iris and iris3 are already available in the workspace</span>

<span class="c1"># Convert iris to a data.table: DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">as.data.table</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>

<span class="c1"># For each Species, print the mean Sepal.Length</span>
<span class="n">DT[</span><span class="p">,</span> <span class="nf">.(mean</span><span class="p">(</span><span class="n">Sepal.Length</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(Species</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##       Species    V1
## 1:     setosa 5.006
## 2: versicolor 5.936
## 3:  virginica 6.588
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print mean Sepal.Length, grouping by first letter of Species</span>
<span class="n">DT[</span><span class="p">,</span> <span class="nf">.(mean</span><span class="p">(</span><span class="n">Sepal.Length</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.(substr</span><span class="p">(</span><span class="n">Species</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    substr    V1
## 1:      s 5.006
## 2:      v 6.262
</pre></div>
</td></tr></table>

<h3 id="using-n-and-by">Using <code class="codehilite"><span class="na">.N</span></code> and <code class="codehilite">by</code><a class="headerlink" href="#using-n-and-by" title="Permanent link">&para;</a></h3>
<p><code class="codehilite"><span class="na">.N</span></code>, number, in row or column.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># data.table version of iris: DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">as.data.table</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>

<span class="c1"># Group the specimens by Sepal area (to the nearest 10 cm2) and count how many occur in each group.</span>
<span class="n">DT[</span><span class="p">,</span> <span class="n">.N</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">10</span> <span class="o">*</span> <span class="nf">round</span><span class="p">(</span><span class="n">Sepal.Length</span> <span class="o">*</span> <span class="n">Sepal.Width</span> <span class="o">/</span> <span class="m">10</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    round   N
## 1:    20 117
## 2:    10  29
## 3:    30   4
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Now name the output columns `Area` and `Count`</span>
<span class="n">DT[</span><span class="p">,</span> <span class="n">.(Count</span> <span class="o">=</span> <span class="n">.N</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(Area</span> <span class="o">=</span> <span class="m">10</span> <span class="o">*</span> <span class="nf">round</span><span class="p">(</span><span class="n">Sepal.Length</span> <span class="o">*</span> <span class="n">Sepal.Width</span> <span class="o">/</span> <span class="m">10</span><span class="p">))</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    Area Count
## 1:   20   117
## 2:   10    29
## 3:   30     4
</pre></div>
</td></tr></table>

<h3 id="return-multiple-numbers-in-j">Return multiple numbers in <code class="codehilite">j</code><a class="headerlink" href="#return-multiple-numbers-in-j" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Create the data.table DT</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="kc">letters</span><span class="n">[2</span><span class="o">:</span><span class="m">1</span><span class="n">]</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">4L</span><span class="p">),</span> <span class="n">B</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">2L</span><span class="p">),</span> <span class="n">C</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">8</span><span class="p">))</span>

<span class="c1"># Create the new data.table, DT2</span>
<span class="n">DT2</span> <span class="o">&lt;-</span> <span class="n">DT[</span><span class="p">,</span> <span class="n">.(C</span> <span class="o">=</span> <span class="nf">cumsum</span><span class="p">(</span><span class="n">C</span><span class="p">)),</span> <span class="n">by</span><span class="o">=</span><span class="n">.(A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span><span class="n">]</span>

<span class="c1"># Select from DT2 the last two values from C while you group by A</span>
<span class="n">DT2[</span><span class="p">,</span> <span class="n">.(C</span> <span class="o">=</span> <span class="nf">tail</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="m">2</span><span class="p">)),</span> <span class="n">by</span><span class="o">=</span><span class="n">A]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A C
## 1: b 4
## 2: b 9
## 3: a 2
## 4: a 8
</pre></div>
</td></tr></table>

<h2 id="datatable-yeoman"><code class="codehilite">data.table</code> yeoman<a class="headerlink" href="#datatable-yeoman" title="Permanent link">&para;</a></h2>
<h3 id="chaining-the-basics">Chaining, the basics<a class="headerlink" href="#chaining-the-basics" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Build DT</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="kc">letters</span><span class="n">[2</span><span class="o">:</span><span class="m">1</span><span class="n">]</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">4L</span><span class="p">),</span> <span class="n">B</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">2L</span><span class="p">),</span> <span class="n">C</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">8</span><span class="p">))</span> 
<span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B C
## 1: b 1 3
## 2: b 1 8
## 3: b 2 4
## 4: b 2 5
## 5: a 3 1
## 6: a 3 7
## 7: a 4 2
## 8: a 4 6
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Use chaining</span>
<span class="c1"># Cumsum of C while grouping by A and B, and then select last two values of C while grouping by A</span>
<span class="n">DT[</span><span class="p">,</span> <span class="n">.(C</span> <span class="o">=</span> <span class="nf">cumsum</span><span class="p">(</span><span class="n">C</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span><span class="n">][</span><span class="p">,</span> <span class="n">.(C</span> <span class="o">=</span> <span class="nf">tail</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="m">2</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(A</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A C
## 1: b 4
## 2: b 9
## 3: a 2
## 4: a 8
</pre></div>
</td></tr></table>

<p><strong>Chaining your <code class="codehilite">iris</code> dataset</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>

<span class="c1"># Perform chained operations on DT</span>
<span class="n">DT[</span><span class="p">,</span> <span class="n">.(Sepal.Length</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">Sepal.Length</span><span class="p">),</span> <span class="n">Sepal.Width</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">),</span> <span class="n">Petal.Length</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">),</span> <span class="n">Petal.Width</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">Petal.Width</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(Species</span><span class="p">)</span><span class="n">]</span><span class="nf">[order</span><span class="p">(</span><span class="n">Species</span><span class="p">,</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##       Species Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1:  virginica          6.5         3.0         5.55         2.0
## 2: versicolor          5.9         2.8         4.35         1.3
## 3:     setosa          5.0         3.4         1.50         0.2
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</pre></div>
</td></tr></table>

<h3 id="programming-time-vs-readability">Programming time vs readability<a class="headerlink" href="#programming-time-vs-readability" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">13</span><span class="p">)</span>
<span class="n">z</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="c1"># Mean of columns</span>
<span class="n">DT[</span><span class="p">,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">mean</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(x</span><span class="p">)</span><span class="n">]</span> 
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    x        y        z
## 1: 2 6.500000 7.500000
## 2: 1 7.666667 8.666667
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Median of columns</span>
<span class="n">DT[</span><span class="p">,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">median</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(x</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    x y z
## 1: 2 7 8
## 2: 1 7 8
</pre></div>
</td></tr></table>

<h3 id="introducing-sdcols">Introducing <code class="codehilite"><span class="na">.SDcols</span></code><a class="headerlink" href="#introducing-sdcols" title="Permanent link">&para;</a></h3>
<p><code class="codehilite"><span class="na">.SDcols</span></code> specifies the columns of <code class="codehilite">DT</code> that are included in <code class="codehilite"><span class="na">.SD</span></code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">grp</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span>
<span class="n">Q1</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">Q2</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="n">Q3</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
<span class="n">H1</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="n">H2</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span><span class="p">,</span> <span class="n">Q3</span><span class="p">,</span> <span class="n">H1</span><span class="p">,</span> <span class="n">H2</span><span class="p">)</span>

<span class="c1"># Calculate the sum of the Q columns</span>
<span class="n">DT[</span><span class="p">,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">sum</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    Q1 Q2 Q3
## 1: 18 14 16
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Calculate the sum of columns H1 and H2 </span>
<span class="n">DT[</span><span class="p">,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">sum</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">5</span><span class="o">:</span><span class="m">6</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    H1 H2
## 1: 12 15
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Select all but the first row of groups 1 and 2, returning only the grp column and the Q columns. </span>
<span class="n">DT[</span><span class="p">,</span> <span class="n">.SD[</span><span class="m">-1</span><span class="n">]</span><span class="p">,</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(grp</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    grp Q1 Q2 Q3
## 1:   6  3  4  1
## 2:   8  5  4  5
## 3:   8  3  4  2
</pre></div>
</td></tr></table>

<h3 id="mixing-it-together-lapply-sd-sdcols-and-n">Mixing it together: <code class="codehilite">lapply</code>, <code class="codehilite"><span class="na">.SD</span></code>, <code class="codehilite">SDcols</code> and <code class="codehilite"><span class="na">.N</span></code><a class="headerlink" href="#mixing-it-together-lapply-sd-sdcols-and-n" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">13</span><span class="p">)</span>
<span class="n">z</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="c1"># Sum of all columns and the number of rows</span>
<span class="c1"># For the first part, you need to combine the returned list from lapply, .SD and .SDcols and the integer vector of .N. You have to this because the result of the two together has to be a list again, with all values put together.</span>
<span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    x  y  z
## 1: 2  1  2
## 2: 1  3  4
## 3: 2  5  6
## 4: 1  7  8
## 5: 2  9 10
## 6: 2 11 12
## 7: 1 13 14
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">DT[</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">sum</span><span class="p">),</span> <span class="n">.N</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">x]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    x x  y  z N
## 1: 2 8 26 30 4
## 2: 1 3 23 26 3
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Cumulative sum of column x and y while grouping by x and z &gt; 8</span>
<span class="n">DT[</span><span class="p">,</span><span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">cumsum</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(by1</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">by2</span> <span class="o">=</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="m">8</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    by1   by2 x  y
## 1:   2 FALSE 2  1
## 2:   2 FALSE 4  6
## 3:   1 FALSE 1  3
## 4:   1 FALSE 2 10
## 5:   2  TRUE 2  9
## 6:   2  TRUE 4 20
## 7:   1  TRUE 1 13
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Chaining</span>
<span class="n">DT[</span><span class="p">,</span><span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">cumsum</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(by1</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">by2</span> <span class="o">=</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="m">8</span><span class="p">)</span><span class="n">][</span><span class="p">,</span><span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">max</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by1]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    by1 x  y
## 1:   2 4 20
## 2:   1 2 13
</pre></div>
</td></tr></table>

<h3 id="adding-updating-and-removing-columns">Adding, updating, and removing columns<a class="headerlink" href="#adding-updating-and-removing-columns" title="Permanent link">&para;</a></h3>
<p><code class="codehilite">:=</code> is defined for use in <code class="codehilite">j</code> only.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># The data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="kc">letters</span><span class="nf">[c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="n">]</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>
<span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B
## 1: a 1
## 2: a 2
## 3: a 3
## 4: b 4
## 5: b 5
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add column by reference: Total</span>
<span class="n">DT[</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;Total&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">B</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(A</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B Total
## 1: a 1     6
## 2: a 2     6
## 3: a 3     6
## 4: b 4     9
## 5: b 5     9
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add 1 to column B</span>
<span class="n">DT</span><span class="nf">[c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="nf">as.integer</span><span class="p">(</span><span class="m">1</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B Total
## 1: a 1     6
## 2: a 3     6
## 3: a 3     6
## 4: b 5     9
## 5: b 5     9
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add a new column Total2</span>
<span class="n">DT[2</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="s">&#39;:=&#39;</span><span class="p">(</span><span class="n">Total2</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">B</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.(A</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B Total Total2
## 1: a 1     6     NA
## 2: a 3     6      6
## 3: a 3     6      6
## 4: b 5     9      5
## 5: b 5     9     NA
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Remove the Total column</span>
<span class="n">DT[</span><span class="p">,</span> <span class="n">Total</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B Total2
## 1: a 1     NA
## 2: a 3      6
## 3: a 3      6
## 4: b 5      5
## 5: b 5     NA
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Select the third column using `[[`</span>
<span class="n">DT[[3]]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## [1] NA  6  6  5 NA
</pre></div>
</td></tr></table>

<h3 id="the-functional-form">The functional form<a class="headerlink" href="#the-functional-form" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># A data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">B</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>

<span class="c1"># Update B, add C and D</span>
<span class="n">DT[</span><span class="p">,</span> <span class="nf">`:=`</span><span class="p">(</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B C D
## 1: 1 2 2 2
## 2: 1 3 3 2
## 3: 1 4 4 2
## 4: 2 5 6 2
## 5: 2 6 7 2
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Delete my_cols</span>
<span class="n">my_cols</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">)</span>
<span class="n">DT[</span><span class="p">,</span> <span class="p">(</span><span class="n">my_cols</span><span class="p">)</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A D
## 1: 1 2
## 2: 1 2
## 3: 1 2
## 4: 2 2
## 5: 2 2
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Delete column 2 by number</span>
<span class="n">DT[</span><span class="p">,</span> <span class="m">2</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A
## 1: 1
## 2: 1
## 3: 1
## 4: 2
## 5: 2
</pre></div>
</td></tr></table>

<h3 id="ready-set-go">Ready, <code class="codehilite">set</code>, go!<a class="headerlink" href="#ready-set-go" title="Permanent link">&para;</a></h3>
<p>The <code class="codehilite">set</code> function is used to repeatedly update a data.table by reference. You can think of the <code class="codehilite">set</code> function as a loopable.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="n">C</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
<span class="n">D</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>

<span class="c1"># Set the seed</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>

<span class="c1"># Check the DT</span>
<span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     A B C D
##  1: 2 2 5 3
##  2: 2 1 2 3
##  3: 3 4 4 3
##  4: 5 2 1 1
##  5: 2 4 2 5
##  6: 5 3 2 4
##  7: 5 4 1 4
##  8: 4 5 2 1
##  9: 4 2 5 4
## 10: 1 4 2 3
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># For loop with set</span>
<span class="nf">for </span><span class="p">(</span><span class="n">l</span> <span class="n">in</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">)</span> <span class="nf">set</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="nf">sample</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">3</span><span class="p">),</span> <span class="n">l</span><span class="p">,</span> <span class="kc">NA</span><span class="p">)</span>

<span class="c1"># Change the column names to lowercase</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">))</span>

<span class="c1"># Print the resulting DT to the console</span>
<span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     a  b  c  d
##  1: 2  2  5  3
##  2: 2  1 NA  3
##  3: 3 NA  4  3
##  4: 5 NA  1  1
##  5: 2 NA  2  5
##  6: 5  3  2 NA
##  7: 5  4  1  4
##  8: 4  5 NA  1
##  9: 4  2  5 NA
## 10: 1  4 NA NA
</pre></div>
</td></tr></table>

<p><strong>The <code class="codehilite">set</code> family</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Define DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="kc">letters</span><span class="nf">[c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="n">]</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: a 1
## 2: a 1
## 3: a 1
## 4: b 1
## 5: b 1
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add a postfix &#39;_2&#39; to all column names</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span> <span class="nf">paste0</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">),</span> <span class="s">&#39;_2&#39;</span><span class="p">))</span>
<span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a_2 b_2
## 1:   a   1
## 2:   a   1
## 3:   a   1
## 4:   b   1
## 5:   b   1
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Change column name &#39;a_2&#39; to &#39;A2&#39;</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="s">&#39;a_2&#39;</span><span class="p">,</span> <span class="s">&#39;A2&#39;</span><span class="p">)</span>
<span class="n">DT</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A2 b_2
## 1:  a   1
## 2:  a   1
## 3:  a   1
## 4:  b   1
## 5:  b   1
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Reverse the order of the columns</span>
<span class="nf">setcolorder</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;b_2&#39;</span><span class="p">,</span><span class="s">&#39;A2&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<h2 id="datatable-expert"><code class="codehilite">data.table</code> expert<a class="headerlink" href="#datatable-expert" title="Permanent link">&para;</a></h2>
<h3 id="selecting-rows-the-datatable-way">Selecting rows the <code class="codehilite">data.table</code> way<a class="headerlink" href="#selecting-rows-the-datatable-way" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Convert iris to a data.table</span>
<span class="n">iris</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="s">&#39;Sepal.Length&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Length</span><span class="p">,</span> <span class="s">&#39;Sepal.Width&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Width</span><span class="p">,</span> <span class="s">&#39;Petal.Length&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Petal.Length</span><span class="p">,</span> <span class="s">&#39;Petal.Width&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Petal.Width</span><span class="p">,</span> <span class="s">&#39;Species&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">)</span>
<span class="n">iris</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Species is &#39;virginica&#39;</span>
<span class="nf">head</span><span class="p">(</span><span class="n">iris[Species</span> <span class="o">==</span> <span class="s">&#39;virginica&#39;</span><span class="n">]</span><span class="p">,</span> <span class="m">20</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##  1:          6.3         3.3          6.0         2.5 virginica
##  2:          5.8         2.7          5.1         1.9 virginica
##  3:          7.1         3.0          5.9         2.1 virginica
##  4:          6.3         2.9          5.6         1.8 virginica
##  5:          6.5         3.0          5.8         2.2 virginica
##  6:          7.6         3.0          6.6         2.1 virginica
##  7:          4.9         2.5          4.5         1.7 virginica
##  8:          7.3         2.9          6.3         1.8 virginica
##  9:          6.7         2.5          5.8         1.8 virginica
## 10:          7.2         3.6          6.1         2.5 virginica
## 11:          6.5         3.2          5.1         2.0 virginica
## 12:          6.4         2.7          5.3         1.9 virginica
## 13:          6.8         3.0          5.5         2.1 virginica
## 14:          5.7         2.5          5.0         2.0 virginica
## 15:          5.8         2.8          5.1         2.4 virginica
## 16:          6.4         3.2          5.3         2.3 virginica
## 17:          6.5         3.0          5.5         1.8 virginica
## 18:          7.7         3.8          6.7         2.2 virginica
## 19:          7.7         2.6          6.9         2.3 virginica
## 20:          6.0         2.2          5.0         1.5 virginica
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Species is either &#39;virginica&#39; or &#39;versicolor&#39;</span>
<span class="nf">head</span><span class="p">(</span><span class="n">iris[Species</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;virginica&#39;</span><span class="p">,</span> <span class="s">&#39;versicolor&#39;</span><span class="p">)</span><span class="n">]</span><span class="p">,</span> <span class="m">20</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
##  1:          7.0         3.2          4.7         1.4 versicolor
##  2:          6.4         3.2          4.5         1.5 versicolor
##  3:          6.9         3.1          4.9         1.5 versicolor
##  4:          5.5         2.3          4.0         1.3 versicolor
##  5:          6.5         2.8          4.6         1.5 versicolor
##  6:          5.7         2.8          4.5         1.3 versicolor
##  7:          6.3         3.3          4.7         1.6 versicolor
##  8:          4.9         2.4          3.3         1.0 versicolor
##  9:          6.6         2.9          4.6         1.3 versicolor
## 10:          5.2         2.7          3.9         1.4 versicolor
## 11:          5.0         2.0          3.5         1.0 versicolor
## 12:          5.9         3.0          4.2         1.5 versicolor
## 13:          6.0         2.2          4.0         1.0 versicolor
## 14:          6.1         2.9          4.7         1.4 versicolor
## 15:          5.6         2.9          3.6         1.3 versicolor
## 16:          6.7         3.1          4.4         1.4 versicolor
## 17:          5.6         3.0          4.5         1.5 versicolor
## 18:          5.8         2.7          4.1         1.0 versicolor
## 19:          6.2         2.2          4.5         1.5 versicolor
## 20:          5.6         2.5          3.9         1.1 versicolor
</pre></div>
</td></tr></table>

<h3 id="removing-columns-and-adapting-your-column-names">Removing columns and adapting your column names<a class="headerlink" href="#removing-columns-and-adapting-your-column-names" title="Permanent link">&para;</a></h3>
<p>Refer to a regex cheat sheet for metacharacter.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># iris as a data.table</span>
<span class="n">iris</span> <span class="o">&lt;-</span> <span class="nf">as.data.table</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>
<span class="n">iris</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Remove the &#39;Sepal.&#39; prefix</span>
<span class="c1">#gsub(&#39;([ab])&#39;, &#39;\\1_\\1_&#39;, &#39;abc and ABC&#39;) = pattern, replacement, x</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Sepal.Length&#39;</span><span class="p">,</span> <span class="s">&#39;Sepal.Width&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Length&#39;</span><span class="p">,</span><span class="s">&#39;Width&#39;</span><span class="p">))</span> 
<span class="c1">#gsub(&#39;^Sepal\\.&#39;,&#39;&#39;, iris)</span>

<span class="c1"># Remove the two columns starting with &#39;Petal&#39;</span>
<span class="n">iris[</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Petal.Length&#39;</span><span class="p">,</span> <span class="s">&#39;Petal.Width&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Length Width   Species
##   1:    5.1   3.5    setosa
##   2:    4.9   3.0    setosa
##   3:    4.7   3.2    setosa
##   4:    4.6   3.1    setosa
##   5:    5.0   3.6    setosa
##  ---                       
## 146:    6.7   3.0 virginica
## 147:    6.3   2.5 virginica
## 148:    6.5   3.0 virginica
## 149:    6.2   3.4 virginica
## 150:    5.9   3.0 virginica
</pre></div>
</td></tr></table>

<h3 id="understanding-automatic-indexing">Understanding automatic indexing<a class="headerlink" href="#understanding-automatic-indexing" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Cleaned up iris data.table</span>
<span class="n">iris2</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">Length</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Length</span><span class="p">,</span> <span class="n">Width</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Width</span><span class="p">,</span> <span class="n">Species</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">)</span>
<span class="n">iris2</span> <span class="o">&lt;-</span> <span class="nf">as.data.table</span><span class="p">(</span><span class="n">iris2</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Area is greater than 20 square centimeters</span>
<span class="n">iris2[</span> <span class="n">Width</span> <span class="o">*</span> <span class="n">Length</span> <span class="o">&gt;</span> <span class="m">20</span> <span class="n">]</span><span class="p">,</span> <span class="m">20</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>   Length Width    Species is_large
 1:    5.4   3.9     setosa    FALSE
 2:    5.8   4.0     setosa    FALSE
 3:    5.7   4.4     setosa     TRUE
 4:    5.4   3.9     setosa    FALSE
 5:    5.7   3.8     setosa    FALSE
 6:    5.2   4.1     setosa    FALSE
 7:    5.5   4.2     setosa    FALSE
 8:    7.0   3.2 versicolor    FALSE
 9:    6.4   3.2 versicolor    FALSE
10:    6.9   3.1 versicolor    FALSE
11:    6.3   3.3 versicolor    FALSE
12:    6.7   3.1 versicolor    FALSE
13:    6.7   3.0 versicolor    FALSE
14:    6.0   3.4 versicolor    FALSE
15:    6.7   3.1 versicolor    FALSE
16:    6.3   3.3  virginica    FALSE
17:    7.1   3.0  virginica    FALSE
18:    7.6   3.0  virginica    FALSE
19:    7.3   2.9  virginica    FALSE
20:    7.2   3.6  virginica     TRUE
...
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add new boolean column</span>
<span class="n">iris2[</span><span class="p">,</span> <span class="n">is_large</span> <span class="o">:=</span> <span class="n">Width</span> <span class="o">*</span> <span class="n">Length</span> <span class="o">&gt;</span> <span class="m">25</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Now large observations with is_large</span>
<span class="n">iris2[is_large</span> <span class="o">==</span> <span class="kc">TRUE</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>   Length Width   Species is_large
1:    5.7   4.4    setosa     TRUE
2:    7.2   3.6 virginica     TRUE
3:    7.7   3.8 virginica     TRUE
4:    7.9   3.8 virginica     TRUE
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">iris2</span><span class="nf">[</span><span class="p">(</span><span class="n">is_large</span><span class="p">)</span><span class="n">]</span> <span class="c1"># Also OK</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>   Length Width   Species is_large
1:    5.7   4.4    setosa     TRUE
2:    7.2   3.6 virginica     TRUE
3:    7.7   3.8 virginica     TRUE
4:    7.9   3.8 virginica     TRUE
</pre></div>
</td></tr></table>

<h3 id="selecting-groups-or-parts-of-groups">Selecting groups or parts of groups<a class="headerlink" href="#selecting-groups-or-parts-of-groups" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># The &#39;keyed&#39; data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="kc">letters</span><span class="nf">[c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span><span class="n">]</span><span class="p">,</span>
                 <span class="n">B</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span><span class="m">8</span> <span class="p">,</span><span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 <span class="n">C</span> <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">)</span>
<span class="nf">setkey</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

<span class="c1"># Select the &#39;b&#39; group</span>
<span class="n">DT[</span><span class="s">&#39;b&#39;</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 1  8
## 2: b 5  6
## 3: b 8 11
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># &#39;b&#39; and &#39;c&#39; groups</span>
<span class="n">DT</span><span class="nf">[c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 1  8
## 2: b 5  6
## 3: b 8 11
## 4: c 6 12
## 5: c 9  9
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># The first row of the &#39;b&#39; and &#39;c&#39; groups</span>
<span class="n">DT</span><span class="nf">[c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="n">mult</span> <span class="o">=</span> <span class="s">&#39;first&#39;</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 1  8
## 2: c 6 12
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># First and last row of the &#39;b&#39; and &#39;c&#39; groups</span>
<span class="n">DT</span><span class="nf">[c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="n">.SD</span><span class="nf">[c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">.N</span><span class="p">)</span><span class="n">]</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.EACHI]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 1  8
## 2: b 8 11
## 3: c 6 12
## 4: c 9  9
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Copy and extend code for instruction 4: add printout</span>
<span class="n">DT</span><span class="nf">[c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="n">.SD</span><span class="p">);</span> <span class="n">.SD</span><span class="nf">[c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">.N</span><span class="p">)</span><span class="n">]</span> <span class="p">},</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.EACHI]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    B  C
## 1: 1  8
## 2: 5  6
## 3: 8 11
##    B  C
## 1: 6 12
## 2: 9  9

##    A B  C
## 1: b 1  8
## 2: b 8 11
## 3: c 6 12
## 4: c 9  9
</pre></div>
</td></tr></table>

<h3 id="rolling-joins">Rolling joins<a class="headerlink" href="#rolling-joins" title="Permanent link">&para;</a></h3>
<p><strong>Rolling joins &ndash; part one</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Keyed data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="kc">letters</span><span class="nf">[c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span><span class="n">]</span><span class="p">,</span>                  <span class="n">B</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 <span class="n">C</span> <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> 
                 <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;A,B&#39;</span><span class="p">)</span>

<span class="c1"># Get the key of DT</span>
<span class="nf">key</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## [1] &quot;A&quot; &quot;B&quot;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Row where A == &#39;b&#39; &amp; B == 6</span>
<span class="nf">setkey</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="n">DT</span><span class="nf">[.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 6 NA
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Return the prevailing row</span>
<span class="n">DT</span><span class="nf">[.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> <span class="n">roll</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B C
## 1: b 6 6
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Return the nearest row</span>
<span class="n">DT</span><span class="nf">[.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> <span class="n">roll</span> <span class="o">=+</span> <span class="kc">Inf</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B C
## 1: b 6 6
</pre></div>
</td></tr></table>

<p><strong>Rolling joins &ndash; part two</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Keyed data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="kc">letters</span><span class="nf">[c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span><span class="n">]</span><span class="p">,</span>                  <span class="n">B</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 <span class="n">C</span> <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> 
                 <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;A,B&#39;</span><span class="p">)</span>

<span class="c1"># Look at the sequence (-2):10 for the &#39;b&#39; group</span>
<span class="n">DT</span><span class="nf">[.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     A  B  C
##  1: b -2 NA
##  2: b -1 NA
##  3: b  0 NA
##  4: b  1  8
##  5: b  2 NA
##  6: b  3 NA
##  7: b  4 NA
##  8: b  5  6
##  9: b  6 NA
## 10: b  7 NA
## 11: b  8 11
## 12: b  9 NA
## 13: b 10 NA
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add code: carry the prevailing values forwards</span>
<span class="n">DT</span><span class="nf">[.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">),</span> <span class="n">roll</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     A  B  C
##  1: b -2 NA
##  2: b -1 NA
##  3: b  0 NA
##  4: b  1  8
##  5: b  2  8
##  6: b  3  8
##  7: b  4  8
##  8: b  5  6
##  9: b  6  6
## 10: b  7  6
## 11: b  8 11
## 12: b  9 11
## 13: b 10 11
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add code: carry the first observation backwards</span>
<span class="n">DT</span><span class="nf">[.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">),</span> <span class="n">roll</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">rollends</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="n">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     A  B  C
##  1: b -2  8
##  2: b -1  8
##  3: b  0  8
##  4: b  1  8
##  5: b  2  8
##  6: b  3  8
##  7: b  4  8
##  8: b  5  6
##  9: b  6  6
## 10: b  7  6
## 11: b  8 11
## 12: b  9 11
## 13: b 10 11
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../reading_data_into_r_with_readr/" title="Reading Data into R with readr" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Reading Data into R with readr
              </span>
            </div>
          </a>
        
        
          <a href="../data_manipulation_in_r_with_dplyr/" title="Data Manipulation in R with dplyr" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Data Manipulation in R with dplyr
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
        <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-93008985-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(a){a.host!=document.location.host&&a.addEventListener("click",function(){var e=a.getAttribute("data-md-action")||"follow";ga("send","event","outbound",e,a.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
  </body>
</html>