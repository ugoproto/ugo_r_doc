
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A R documentation website.">
      
      
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.0">
    
    
      
        <title>Data Analysis in R, the data.table Way - ugo_r_doc</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8b42a75e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Ubuntu";--md-code-font-family:"Ubuntu Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="red">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ugo_r_doc" class="md-header__button md-logo" aria-label="ugo_r_doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 16 7.36-5.73L21 9l-9-7-9 7 1.63 1.27M12 18.54l-7.38-5.73L3 14.07l9 7 9-7-1.63-1.27L12 18.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ugo_r_doc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Analysis in R, the data.table Way
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/ugoproto/ugo_r_doc.git/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ugo_r_doc
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ugo_r_doc" class="md-nav__button md-logo" aria-label="ugo_r_doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 16 7.36-5.73L21 9l-9-7-9 7 1.63 1.27M12 18.54l-7.38-5.73L3 14.07l9 7 9-7-1.63-1.27L12 18.54z"/></svg>

    </a>
    ugo_r_doc
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ugoproto/ugo_r_doc.git/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ugo_r_doc
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Cheat Sheets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cheat Sheets" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Cheat Sheets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basics_cs/" class="md-nav__link">
        Basics Cheat Sheets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../specializations_cs/" class="md-nav__link">
        Specialization Cheat Sheets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../visualization_cs/" class="md-nav__link">
        Visualization Cheat Sheets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Code and Vade Mecum
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code and Vade Mecum" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Code and Vade Mecum
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../frequentist_bayesian/" class="md-nav__link">
        Frequentist vs. Bayesian
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intermediate_r/" class="md-nav__link">
        Intermediate R
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intermediate_r_the_apply_family/" class="md-nav__link">
        Intermediate R - The apply Family
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Data Wrangling Snippets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Wrangling Snippets" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Data Wrangling Snippets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io_snippets_cleaning/" class="md-nav__link">
        I/O Snippets & Cleaning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reading_data_into_r_with_readr/" class="md-nav__link">
        Reading Data into R with readr
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Data Analysis in R, the data.table Way
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Data Analysis in R, the data.table Way
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-novice" class="md-nav__link">
    data.table novice
  </a>
  
    <nav class="md-nav" aria-label="data.table novice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-and-subset-a-datatable" class="md-nav__link">
    Create and subset a data.table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-to-know-a-datatable" class="md-nav__link">
    Getting to know a data.table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subsetting-data-tables" class="md-nav__link">
    Subsetting data tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-by-basics" class="md-nav__link">
    The by basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-n-and-by" class="md-nav__link">
    Using .N and by
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-multiple-numbers-in-j" class="md-nav__link">
    Return multiple numbers in j
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-yeoman" class="md-nav__link">
    data.table yeoman
  </a>
  
    <nav class="md-nav" aria-label="data.table yeoman">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chaining-the-basics" class="md-nav__link">
    Chaining, the basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programming-time-vs-readability" class="md-nav__link">
    Programming time vs readability
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introducing-sdcols" class="md-nav__link">
    Introducing .SDcols
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixing-it-together-lapply-sd-sdcols-and-n" class="md-nav__link">
    Mixing it together: lapply, .SD, SDcols and .N
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-updating-and-removing-columns" class="md-nav__link">
    Adding, updating, and removing columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-functional-form" class="md-nav__link">
    The functional form
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ready-set-go" class="md-nav__link">
    Ready, set, go!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-expert" class="md-nav__link">
    data.table expert
  </a>
  
    <nav class="md-nav" aria-label="data.table expert">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selecting-rows-the-datatable-way" class="md-nav__link">
    Selecting rows the data.table way
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-columns-and-adapting-your-column-names" class="md-nav__link">
    Removing columns and adapting your column names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-automatic-indexing" class="md-nav__link">
    Understanding automatic indexing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecting-groups-or-parts-of-groups" class="md-nav__link">
    Selecting groups or parts of groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rolling-joins" class="md-nav__link">
    Rolling joins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_manipulation_in_r_with_dplyr/" class="md-nav__link">
        Data Manipulation in R with dplyr
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_wrangling/" class="md-nav__link">
        Data Wrangling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Packages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Packages" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Packages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../googlevis/" class="md-nav__link">
        googleVis (embed HTML plots)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gganimate/" class="md-nav__link">
        gganimate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fast_and_frugal_decision_trees_in_r_with_fftrees/" class="md-nav__link">
        Fast-and-Frugal Decision Trees
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../big_data_analysis_with_revolution_r_enterprise/" class="md-nav__link">
        Big Data Analysis with Revolution R Enterprise
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../time_series_in_r_the_power_of_xts_and_zoo/" class="md-nav__link">
        Time Series in R, The Power of xts and zoo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Plot Snippets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plot Snippets" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Plot Snippets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plot_snippets_basics/" class="md-nav__link">
        Plot Snippets for Exploratory (and some Explanatory) Analyses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plot_snippets_ggplot2/" class="md-nav__link">
        Plot Snippets - ggplot2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plot_snippets_ggvis/" class="md-nav__link">
        Plot Snippets - ggvis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plot_snippets_colours/" class="md-nav__link">
        Plot Snippets - Colours
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          RStudio
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="RStudio" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          RStudio
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../working_with_rstudio_ide/" class="md-nav__link">
        Working with the RStudio IDE
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Tables and Figures
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tables and Figures" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Tables and Figures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tables/" class="md-nav__link">
        Tables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../embedding/" class="md-nav__link">
        Embedding HTML into HTML
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../embedding_2/" class="md-nav__link">
        Embedding Rmd into Rmd
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          A Hands-on Introduction to Statistics with R
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="A Hands-on Introduction to Statistics with R" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          A Hands-on Introduction to Statistics with R
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../a_hands-on_introduction_to_statistics_with_r_course_one_introduction/" class="md-nav__link">
        Statistics with R, Course One, Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../a_hands-on_introduction_to_statistics_with_r_course_two_student_s_t-test/" class="md-nav__link">
        Statistics with R, Course Two, Student's t-test
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../a_hands-on_introduction_to_statistics_with_r_course_three_analysis_of_variance/" class="md-nav__link">
        Statistics with R, Course Three, Analysis of Variance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../a_hands-on_introduction_to_statistics_with_r_course_four_repeated_measures_anova/" class="md-nav__link">
        Statistics with R, Course Four, Repeated Measures ANOVA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../a_hands-on_introduction_to_statistics_with_r_course_five_correlation_and_regression/" class="md-nav__link">
        Statistics with R, Course Five, Correlation and Regression
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../a_hands-on_introduction_to_statistics_with_r_course_six_multiple_regression/" class="md-nav__link">
        Statistics with R, Course Six, Multiple Regression
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../a_hands-on_introduction_to_statistics_with_r_course_seven_moderation_and_mediation/" class="md-nav__link">
        Statistics with R, Course Seven, Moderation and Mediation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../a_hands-on_introduction_to_statistics_with_r_notes/" class="md-nav__link">
        Statistics with R, Notes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-novice" class="md-nav__link">
    data.table novice
  </a>
  
    <nav class="md-nav" aria-label="data.table novice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-and-subset-a-datatable" class="md-nav__link">
    Create and subset a data.table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-to-know-a-datatable" class="md-nav__link">
    Getting to know a data.table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subsetting-data-tables" class="md-nav__link">
    Subsetting data tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-by-basics" class="md-nav__link">
    The by basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-n-and-by" class="md-nav__link">
    Using .N and by
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-multiple-numbers-in-j" class="md-nav__link">
    Return multiple numbers in j
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-yeoman" class="md-nav__link">
    data.table yeoman
  </a>
  
    <nav class="md-nav" aria-label="data.table yeoman">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chaining-the-basics" class="md-nav__link">
    Chaining, the basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programming-time-vs-readability" class="md-nav__link">
    Programming time vs readability
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introducing-sdcols" class="md-nav__link">
    Introducing .SDcols
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixing-it-together-lapply-sd-sdcols-and-n" class="md-nav__link">
    Mixing it together: lapply, .SD, SDcols and .N
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-updating-and-removing-columns" class="md-nav__link">
    Adding, updating, and removing columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-functional-form" class="md-nav__link">
    The functional form
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ready-set-go" class="md-nav__link">
    Ready, set, go!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datatable-expert" class="md-nav__link">
    data.table expert
  </a>
  
    <nav class="md-nav" aria-label="data.table expert">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selecting-rows-the-datatable-way" class="md-nav__link">
    Selecting rows the data.table way
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-columns-and-adapting-your-column-names" class="md-nav__link">
    Removing columns and adapting your column names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-automatic-indexing" class="md-nav__link">
    Understanding automatic indexing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecting-groups-or-parts-of-groups" class="md-nav__link">
    Selecting groups or parts of groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rolling-joins" class="md-nav__link">
    Rolling joins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ugoproto/ugo_r_doc.git/edit/master/docs/data_analysis_in_r_the_data_table_way.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Data Analysis in R, the data.table Way</h1>
                
                <!--
-   [Documentation](#documentation)
-   [1, `data.table` novice](#data.table-novice)
    -   [Create and subset a
        `data.table`](#create-and-subset-a-data.table)
    -   [Getting to know a `data.table`](#getting-to-know-a-data.table)
    -   [Subsetting data tables](#subsetting-data-tables)
    -   [The `by` basics](#the-by-basics)
    -   [Using `.N` and `by`](#using-.n-and-by)
    -   [Return multiple numbers in `j`](#return-multiple-numbers-in-j)
-   [2, `data.table` yeoman](#data.table-yeoman)
    -   [Chaining, the basics](#chaining-the-basics)
    -   [Programming time vs
        readability](#programming-time-vs-readability)
    -   [Introducing `.SDcols`](#introducing-.sdcols)
    -   [Mixing it together: `lapply`, `.SD`, `SDcols` and
        `.N`](#mixing-it-together-lapply-.sd-sdcols-and-.n)
    -   [Adding, updating, and removing
        columns](#adding-updating-and-removing-columns)
    -   [The functional form](#the-functional-form)
    -   [Ready, `set`, go!](#ready-set-go)
-   [3, `data.table` expert](#data.table-expert)
    -   [Selecting rows the `data.table`
        way](#selecting-rows-the-data.table-way)
    -   [Removing columns and adapting your column
        names](#removing-columns-and-adapting-your-column-names)
    -   [Understanding automatic
        indexing](#understanding-automatic-indexing)
    -   [Selecting groups or parts of
        groups](#selecting-groups-or-parts-of-groups)
    -   [Rolling joins](#rolling-joins)
-->
<hr />
<p><strong>Foreword</strong></p>
<ul>
<li>Output options: the &lsquo;tango&rsquo; syntax and the &lsquo;readable&rsquo; theme.</li>
<li>Snippets and results.</li>
</ul>
<hr />
<h2 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h2>
<p><code>data.table</code></p>
<ul>
<li>Extension of <code>data.frame</code>.</li>
<li>Fast aggregation of large data (e.g. 100GB in RAM), fast ordered     joins, fast add/modify/delete of columns by group using no copies at     all, list columns, a fast friendly file reader and parallel file writer. Offers a natural and flexible syntax, for faster development.</li>
</ul>
<p><code>dplyr</code></p>
<ul>
<li>A fast, consistent tool for working with data frame like objects, both in memory and out of memory.</li>
<li>Pipelines.</li>
</ul>
<p><code>tidyr</code></p>
<ul>
<li>An evolution of &lsquo;reshape2&rsquo;. It&rsquo;s designed specifically for data tidying (not general reshaping or aggregating) and works well with dplyr data pipelines.</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">package</th>
<th align="left">'narrower'</th>
<th align="left">'wider'</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>tidyr</code></td>
<td align="left">gather</td>
<td align="left">spread</td>
</tr>
<tr class="even">
<td align="left"><code>reshape2</code></td>
<td align="left">melt</td>
<td align="left">cast</td>
</tr>
<tr class="odd">
<td align="left">spreadsheets</td>
<td align="left">unpivot</td>
<td align="left">pivot</td>
</tr>
<tr class="even">
<td align="left">databases</td>
<td align="left">fold</td>
<td align="left">unfold</td>
</tr>
</tbody>
</table>

<h2 id="datatable-novice"><code>data.table</code> novice<a class="headerlink" href="#datatable-novice" title="Permanent link">&para;</a></h2>
<p>Find out more with <code>?data.table</code>.</p>
<h3 id="create-and-subset-a-datatable">Create and subset a <code>data.table</code><a class="headerlink" href="#create-and-subset-a-datatable" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># The data.table package</span>
<span class="nf">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span>

<span class="c1"># Create my_first_data_table</span>
<span class="n">my_first_data_table</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">))</span>

<span class="c1"># Create a data.table using recycling</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">))</span>

<span class="c1"># Print the third row to the console</span>
<span class="n">DT</span><span class="p">[</span><span class="m">3</span><span class="p">,]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    a b
## 1: 1 C
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Print the second and third row to the console, but do not commas</span>
<span class="n">DT</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    a b
## 1: 2 B
## 2: 1 C
</code></pre></div>
</td></tr></table>
<h3 id="getting-to-know-a-datatable">Getting to know a <code>data.table</code><a class="headerlink" href="#getting-to-know-a-datatable" title="Permanent link">&para;</a></h3>
<p>Like <code>head</code>, <code>tail</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Print the penultimate row of DT using .N</span>
<span class="n">DT</span><span class="p">[</span><span class="n">.N</span> <span class="o">-</span> <span class="m">1</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    a b
## 1: 1 C
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Print the column names of DT, and number of rows and number of columns</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>## [1] &quot;a&quot; &quot;b&quot;
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="nf">dim</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>## [1] 4 2
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Select row 2 twice and row 3, returning a data.table with three rows where row 2 is a duplicate of row 1.</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    a b
## 1: 2 B
## 2: 2 B
## 3: 1 C
</code></pre></div>
</td></tr></table>
<p><code>DT</code> is a data.table/data.frame, but <code>DT[ , B]</code> is a vector; <code>DT[ , .(B)]</code> is a subsetted data.table.</p>
<h3 id="subsetting-data-tables">Subsetting data tables<a class="headerlink" href="#subsetting-data-tables" title="Permanent link">&para;</a></h3>
<p><code>DT[i, j, by]</code> means take <code>DT</code>, subset rows using <code>i</code>, then calculate <code>j</code> grouped by <code>by</code>. You can wrap <code>j</code> with <code>.()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">)</span>
<span class="n">C</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>

<span class="c1"># Subset rows 1 and 3, and columns B and C</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="p">,</span><span class="nf">.</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    B C
## 1: a 6
## 2: c 8
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Assign to ans the correct value</span>
<span class="n">ans</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">DT</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C</span><span class="p">)])</span>

<span class="c1"># Fill in the blanks such that ans2 equals target</span>
<span class="c1">#target &lt;- data.table(B = c(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;),  val = as.integer(c(6:10, 1:5)))</span>
<span class="n">ans2</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">DT</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="nf">as.integer</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)))])</span>
</code></pre></div>
<h3 id="the-by-basics">The <code>by</code> basics<a class="headerlink" href="#the-by-basics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># iris and iris3 are already available in the workspace</span>

<span class="c1"># Convert iris to a data.table: DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">as.data.table</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>

<span class="c1"># For each Species, print the mean Sepal.Length</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">Sepal.Length</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">Species</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##       Species    V1
## 1:     setosa 5.006
## 2: versicolor 5.936
## 3:  virginica 6.588
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Print mean Sepal.Length, grouping by first letter of Species</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">Sepal.Length</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">Species</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    substr    V1
## 1:      s 5.006
## 2:      v 6.262
</code></pre></div>
</td></tr></table>
<h3 id="using-n-and-by">Using <code>.N</code> and <code>by</code><a class="headerlink" href="#using-n-and-by" title="Permanent link">&para;</a></h3>
<p><code>.N</code>, number, in row or column.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># data.table version of iris: DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">as.data.table</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>

<span class="c1"># Group the specimens by Sepal area (to the nearest 10 cm2) and count how many occur in each group.</span>
<span class="n">DT</span><span class="p">[,</span> <span class="n">.N</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">10</span> <span class="o">*</span> <span class="nf">round</span><span class="p">(</span><span class="n">Sepal.Length</span> <span class="o">*</span> <span class="n">Sepal.Width</span> <span class="o">/</span> <span class="m">10</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    round   N
## 1:    20 117
## 2:    10  29
## 3:    30   4
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Now name the output columns `Area` and `Count`</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="n">Count</span> <span class="o">=</span> <span class="n">.N</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">Area</span> <span class="o">=</span> <span class="m">10</span> <span class="o">*</span> <span class="nf">round</span><span class="p">(</span><span class="n">Sepal.Length</span> <span class="o">*</span> <span class="n">Sepal.Width</span> <span class="o">/</span> <span class="m">10</span><span class="p">))]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    Area Count
## 1:   20   117
## 2:   10    29
## 3:   30     4
</code></pre></div>
</td></tr></table>
<h3 id="return-multiple-numbers-in-j">Return multiple numbers in <code>j</code><a class="headerlink" href="#return-multiple-numbers-in-j" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create the data.table DT</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="kc">letters</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">1</span><span class="p">],</span> <span class="n">each</span> <span class="o">=</span> <span class="m">4L</span><span class="p">),</span> <span class="n">B</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">2L</span><span class="p">),</span> <span class="n">C</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">8</span><span class="p">))</span>

<span class="c1"># Create the new data.table, DT2</span>
<span class="n">DT2</span> <span class="o">&lt;-</span> <span class="n">DT</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="n">C</span> <span class="o">=</span> <span class="nf">cumsum</span><span class="p">(</span><span class="n">C</span><span class="p">)),</span> <span class="n">by</span><span class="o">=</span><span class="nf">.</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)]</span>

<span class="c1"># Select from DT2 the last two values from C while you group by A</span>
<span class="n">DT2</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="n">C</span> <span class="o">=</span> <span class="nf">tail</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="m">2</span><span class="p">)),</span> <span class="n">by</span><span class="o">=</span><span class="n">A</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A C
## 1: b 4
## 2: b 9
## 3: a 2
## 4: a 8
</code></pre></div>
</td></tr></table>
<h2 id="datatable-yeoman"><code>data.table</code> yeoman<a class="headerlink" href="#datatable-yeoman" title="Permanent link">&para;</a></h2>
<h3 id="chaining-the-basics">Chaining, the basics<a class="headerlink" href="#chaining-the-basics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Build DT</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="kc">letters</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">1</span><span class="p">],</span> <span class="n">each</span> <span class="o">=</span> <span class="m">4L</span><span class="p">),</span> <span class="n">B</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">2L</span><span class="p">),</span> <span class="n">C</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">8</span><span class="p">))</span> 
<span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B C
## 1: b 1 3
## 2: b 1 8
## 3: b 2 4
## 4: b 2 5
## 5: a 3 1
## 6: a 3 7
## 7: a 4 2
## 8: a 4 6
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Use chaining</span>
<span class="c1"># Cumsum of C while grouping by A and B, and then select last two values of C while grouping by A</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="n">C</span> <span class="o">=</span> <span class="nf">cumsum</span><span class="p">(</span><span class="n">C</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)][,</span> <span class="nf">.</span><span class="p">(</span><span class="n">C</span> <span class="o">=</span> <span class="nf">tail</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="m">2</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">A</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A C
## 1: b 4
## 2: b 9
## 3: a 2
## 4: a 8
</code></pre></div>
</td></tr></table>
<p><strong>Chaining your <code>iris</code> dataset</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>

<span class="c1"># Perform chained operations on DT</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">.</span><span class="p">(</span><span class="n">Sepal.Length</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">Sepal.Length</span><span class="p">),</span> <span class="n">Sepal.Width</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">),</span> <span class="n">Petal.Length</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">),</span> <span class="n">Petal.Width</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">Petal.Width</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">Species</span><span class="p">)][</span><span class="nf">order</span><span class="p">(</span><span class="n">Species</span><span class="p">,</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##       Species Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1:  virginica          6.5         3.0         5.55         2.0
## 2: versicolor          5.9         2.8         4.35         1.3
## 3:     setosa          5.0         3.4         1.50         0.2
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</code></pre></div>
</td></tr></table>
<h3 id="programming-time-vs-readability">Programming time vs readability<a class="headerlink" href="#programming-time-vs-readability" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">13</span><span class="p">)</span>
<span class="n">z</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="c1"># Mean of columns</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">mean</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> 
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    x        y        z
## 1: 2 6.500000 7.500000
## 2: 1 7.666667 8.666667
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Median of columns</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">median</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    x y z
## 1: 2 7 8
## 2: 1 7 8
</code></pre></div>
</td></tr></table>
<h3 id="introducing-sdcols">Introducing <code>.SDcols</code><a class="headerlink" href="#introducing-sdcols" title="Permanent link">&para;</a></h3>
<p><code>.SDcols</code> specifies the columns of <code>DT</code> that are included in <code>.SD</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">grp</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span>
<span class="n">Q1</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">Q2</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="n">Q3</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
<span class="n">H1</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="n">H2</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span><span class="p">,</span> <span class="n">Q3</span><span class="p">,</span> <span class="n">H1</span><span class="p">,</span> <span class="n">H2</span><span class="p">)</span>

<span class="c1"># Calculate the sum of the Q columns</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">sum</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    Q1 Q2 Q3
## 1: 18 14 16
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Calculate the sum of columns H1 and H2 </span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">sum</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">5</span><span class="o">:</span><span class="m">6</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    H1 H2
## 1: 12 15
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Select all but the first row of groups 1 and 2, returning only the grp column and the Q columns. </span>
<span class="n">DT</span><span class="p">[,</span> <span class="n">.SD</span><span class="p">[</span><span class="m">-1</span><span class="p">],</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">grp</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    grp Q1 Q2 Q3
## 1:   6  3  4  1
## 2:   8  5  4  5
## 3:   8  3  4  2
</code></pre></div>
</td></tr></table>
<h3 id="mixing-it-together-lapply-sd-sdcols-and-n">Mixing it together: <code>lapply</code>, <code>.SD</code>, <code>SDcols</code> and <code>.N</code><a class="headerlink" href="#mixing-it-together-lapply-sd-sdcols-and-n" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">13</span><span class="p">)</span>
<span class="n">z</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="c1"># Sum of all columns and the number of rows</span>
<span class="c1"># For the first part, you need to combine the returned list from lapply, .SD and .SDcols and the integer vector of .N. You have to this because the result of the two together has to be a list again, with all values put together.</span>
<span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    x  y  z
## 1: 2  1  2
## 2: 1  3  4
## 3: 2  5  6
## 4: 1  7  8
## 5: 2  9 10
## 6: 2 11 12
## 7: 1 13 14
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="n">DT</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">sum</span><span class="p">),</span> <span class="n">.N</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    x x  y  z N
## 1: 2 8 26 30 4
## 2: 1 3 23 26 3
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Cumulative sum of column x and y while grouping by x and z &gt; 8</span>
<span class="n">DT</span><span class="p">[,</span><span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">cumsum</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">by1</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">by2</span> <span class="o">=</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="m">8</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    by1   by2 x  y
## 1:   2 FALSE 2  1
## 2:   2 FALSE 4  6
## 3:   1 FALSE 1  3
## 4:   1 FALSE 2 10
## 5:   2  TRUE 2  9
## 6:   2  TRUE 4 20
## 7:   1  TRUE 1 13
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Chaining</span>
<span class="n">DT</span><span class="p">[,</span><span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">cumsum</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">by1</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">by2</span> <span class="o">=</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="m">8</span><span class="p">)][,</span><span class="nf">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span> <span class="n">max</span><span class="p">),</span> <span class="n">.SDcols</span> <span class="o">=</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by1</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    by1 x  y
## 1:   2 4 20
## 2:   1 2 13
</code></pre></div>
</td></tr></table>
<h3 id="adding-updating-and-removing-columns">Adding, updating, and removing columns<a class="headerlink" href="#adding-updating-and-removing-columns" title="Permanent link">&para;</a></h3>
<p><code>:=</code> is defined for use in <code>j</code> only.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># The data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)],</span> <span class="n">B</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>
<span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B
## 1: a 1
## 2: a 2
## 3: a 3
## 4: b 4
## 5: b 5
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Add column by reference: Total</span>
<span class="n">DT</span><span class="p">[,</span> <span class="p">(</span><span class="s">&#39;Total&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">B</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">A</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B Total
## 1: a 1     6
## 2: a 2     6
## 3: a 3     6
## 4: b 4     9
## 5: b 5     9
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Add 1 to column B</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="nf">as.integer</span><span class="p">(</span><span class="m">1</span> <span class="o">+</span> <span class="n">B</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B Total
## 1: a 1     6
## 2: a 3     6
## 3: a 3     6
## 4: b 5     9
## 5: b 5     9
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Add a new column Total2</span>
<span class="n">DT</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="s">&#39;:=&#39;</span><span class="p">(</span><span class="n">Total2</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">B</span><span class="p">)),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">A</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B Total Total2
## 1: a 1     6     NA
## 2: a 3     6      6
## 3: a 3     6      6
## 4: b 5     9      5
## 5: b 5     9     NA
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Remove the Total column</span>
<span class="n">DT</span><span class="p">[,</span> <span class="n">Total</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B Total2
## 1: a 1     NA
## 2: a 3      6
## 3: a 3      6
## 4: b 5      5
## 5: b 5     NA
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Select the third column using `[[`</span>
<span class="n">DT</span><span class="p">[[</span><span class="m">3</span><span class="p">]]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>## [1] NA  6  6  5 NA
</code></pre></div>
</td></tr></table>
<h3 id="the-functional-form">The functional form<a class="headerlink" href="#the-functional-form" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># A data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">B</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>

<span class="c1"># Update B, add C and D</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">`:=`</span><span class="p">(</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="m">2</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B C D
## 1: 1 2 2 2
## 2: 1 3 3 2
## 3: 1 4 4 2
## 4: 2 5 6 2
## 5: 2 6 7 2
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete my_cols</span>
<span class="n">my_cols</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">)</span>
<span class="n">DT</span><span class="p">[,</span> <span class="p">(</span><span class="n">my_cols</span><span class="p">)</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A D
## 1: 1 2
## 2: 1 2
## 3: 1 2
## 4: 2 2
## 5: 2 2
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete column 2 by number</span>
<span class="n">DT</span><span class="p">[,</span> <span class="m">2</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A
## 1: 1
## 2: 1
## 3: 1
## 4: 2
## 5: 2
</code></pre></div>
</td></tr></table>
<h3 id="ready-set-go">Ready, <code>set</code>, go!<a class="headerlink" href="#ready-set-go" title="Permanent link">&para;</a></h3>
<p>The <code>set</code> function is used to repeatedly update a data.table by reference. You can think of the <code>set</code> function as a loopable.</p>
<div class="highlight"><pre><span></span><code><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="n">C</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
<span class="n">D</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>

<span class="c1"># Set the seed</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>

<span class="c1"># Check the DT</span>
<span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##     A B C D
##  1: 2 2 5 3
##  2: 2 1 2 3
##  3: 3 4 4 3
##  4: 5 2 1 1
##  5: 2 4 2 5
##  6: 5 3 2 4
##  7: 5 4 1 4
##  8: 4 5 2 1
##  9: 4 2 5 4
## 10: 1 4 2 3
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># For loop with set</span>
<span class="nf">for </span><span class="p">(</span><span class="n">l</span> <span class="n">in</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">)</span> <span class="nf">set</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="nf">sample</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">3</span><span class="p">),</span> <span class="n">l</span><span class="p">,</span> <span class="kc">NA</span><span class="p">)</span>

<span class="c1"># Change the column names to lowercase</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">))</span>

<span class="c1"># Print the resulting DT to the console</span>
<span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##     a  b  c  d
##  1: 2  2  5  3
##  2: 2  1 NA  3
##  3: 3 NA  4  3
##  4: 5 NA  1  1
##  5: 2 NA  2  5
##  6: 5  3  2 NA
##  7: 5  4  1  4
##  8: 4  5 NA  1
##  9: 4  2  5 NA
## 10: 1  4 NA NA
</code></pre></div>
</td></tr></table>
<p><strong>The <code>set</code> family</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Define DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)],</span> <span class="n">b</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    a b
## 1: a 1
## 2: a 1
## 3: a 1
## 4: b 1
## 5: b 1
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Add a postfix &#39;_2&#39; to all column names</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span> <span class="nf">paste0</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">),</span> <span class="s">&#39;_2&#39;</span><span class="p">))</span>
<span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    a_2 b_2
## 1:   a   1
## 2:   a   1
## 3:   a   1
## 4:   b   1
## 5:   b   1
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Change column name &#39;a_2&#39; to &#39;A2&#39;</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="s">&#39;a_2&#39;</span><span class="p">,</span> <span class="s">&#39;A2&#39;</span><span class="p">)</span>
<span class="n">DT</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A2 b_2
## 1:  a   1
## 2:  a   1
## 3:  a   1
## 4:  b   1
## 5:  b   1
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Reverse the order of the columns</span>
<span class="nf">setcolorder</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;b_2&#39;</span><span class="p">,</span><span class="s">&#39;A2&#39;</span><span class="p">))</span>
</code></pre></div>
<h2 id="datatable-expert"><code>data.table</code> expert<a class="headerlink" href="#datatable-expert" title="Permanent link">&para;</a></h2>
<h3 id="selecting-rows-the-datatable-way">Selecting rows the <code>data.table</code> way<a class="headerlink" href="#selecting-rows-the-datatable-way" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Convert iris to a data.table</span>
<span class="n">iris</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="s">&#39;Sepal.Length&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Length</span><span class="p">,</span> <span class="s">&#39;Sepal.Width&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Width</span><span class="p">,</span> <span class="s">&#39;Petal.Length&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Petal.Length</span><span class="p">,</span> <span class="s">&#39;Petal.Width&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Petal.Width</span><span class="p">,</span> <span class="s">&#39;Species&#39;</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">)</span>
<span class="n">iris</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Species is &#39;virginica&#39;</span>
<span class="nf">head</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="n">Species</span> <span class="o">==</span> <span class="s">&#39;virginica&#39;</span><span class="p">],</span> <span class="m">20</span><span class="p">)</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##  1:          6.3         3.3          6.0         2.5 virginica
##  2:          5.8         2.7          5.1         1.9 virginica
##  3:          7.1         3.0          5.9         2.1 virginica
##  4:          6.3         2.9          5.6         1.8 virginica
##  5:          6.5         3.0          5.8         2.2 virginica
##  6:          7.6         3.0          6.6         2.1 virginica
##  7:          4.9         2.5          4.5         1.7 virginica
##  8:          7.3         2.9          6.3         1.8 virginica
##  9:          6.7         2.5          5.8         1.8 virginica
## 10:          7.2         3.6          6.1         2.5 virginica
## 11:          6.5         3.2          5.1         2.0 virginica
## 12:          6.4         2.7          5.3         1.9 virginica
## 13:          6.8         3.0          5.5         2.1 virginica
## 14:          5.7         2.5          5.0         2.0 virginica
## 15:          5.8         2.8          5.1         2.4 virginica
## 16:          6.4         3.2          5.3         2.3 virginica
## 17:          6.5         3.0          5.5         1.8 virginica
## 18:          7.7         3.8          6.7         2.2 virginica
## 19:          7.7         2.6          6.9         2.3 virginica
## 20:          6.0         2.2          5.0         1.5 virginica
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Species is either &#39;virginica&#39; or &#39;versicolor&#39;</span>
<span class="nf">head</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="n">Species</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;virginica&#39;</span><span class="p">,</span> <span class="s">&#39;versicolor&#39;</span><span class="p">)],</span> <span class="m">20</span><span class="p">)</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
##  1:          7.0         3.2          4.7         1.4 versicolor
##  2:          6.4         3.2          4.5         1.5 versicolor
##  3:          6.9         3.1          4.9         1.5 versicolor
##  4:          5.5         2.3          4.0         1.3 versicolor
##  5:          6.5         2.8          4.6         1.5 versicolor
##  6:          5.7         2.8          4.5         1.3 versicolor
##  7:          6.3         3.3          4.7         1.6 versicolor
##  8:          4.9         2.4          3.3         1.0 versicolor
##  9:          6.6         2.9          4.6         1.3 versicolor
## 10:          5.2         2.7          3.9         1.4 versicolor
## 11:          5.0         2.0          3.5         1.0 versicolor
## 12:          5.9         3.0          4.2         1.5 versicolor
## 13:          6.0         2.2          4.0         1.0 versicolor
## 14:          6.1         2.9          4.7         1.4 versicolor
## 15:          5.6         2.9          3.6         1.3 versicolor
## 16:          6.7         3.1          4.4         1.4 versicolor
## 17:          5.6         3.0          4.5         1.5 versicolor
## 18:          5.8         2.7          4.1         1.0 versicolor
## 19:          6.2         2.2          4.5         1.5 versicolor
## 20:          5.6         2.5          3.9         1.1 versicolor
</code></pre></div>
</td></tr></table>
<h3 id="removing-columns-and-adapting-your-column-names">Removing columns and adapting your column names<a class="headerlink" href="#removing-columns-and-adapting-your-column-names" title="Permanent link">&para;</a></h3>
<p>Refer to a regex cheat sheet for metacharacter.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># iris as a data.table</span>
<span class="n">iris</span> <span class="o">&lt;-</span> <span class="nf">as.data.table</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>
<span class="n">iris</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Remove the &#39;Sepal.&#39; prefix</span>
<span class="c1">#gsub(&#39;([ab])&#39;, &#39;\\1_\\1_&#39;, &#39;abc and ABC&#39;) = pattern, replacement, x</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Sepal.Length&#39;</span><span class="p">,</span> <span class="s">&#39;Sepal.Width&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Length&#39;</span><span class="p">,</span><span class="s">&#39;Width&#39;</span><span class="p">))</span> 
<span class="c1">#gsub(&#39;^Sepal\\.&#39;,&#39;&#39;, iris)</span>

<span class="c1"># Remove the two columns starting with &#39;Petal&#39;</span>
<span class="n">iris</span><span class="p">[,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Petal.Length&#39;</span><span class="p">,</span> <span class="s">&#39;Petal.Width&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##      Length Width   Species
##   1:    5.1   3.5    setosa
##   2:    4.9   3.0    setosa
##   3:    4.7   3.2    setosa
##   4:    4.6   3.1    setosa
##   5:    5.0   3.6    setosa
##  ---                       
## 146:    6.7   3.0 virginica
## 147:    6.3   2.5 virginica
## 148:    6.5   3.0 virginica
## 149:    6.2   3.4 virginica
## 150:    5.9   3.0 virginica
</code></pre></div>
</td></tr></table>
<h3 id="understanding-automatic-indexing">Understanding automatic indexing<a class="headerlink" href="#understanding-automatic-indexing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Cleaned up iris data.table</span>
<span class="n">iris2</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">Length</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Length</span><span class="p">,</span> <span class="n">Width</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Width</span><span class="p">,</span> <span class="n">Species</span> <span class="o">=</span> <span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">)</span>
<span class="n">iris2</span> <span class="o">&lt;-</span> <span class="nf">as.data.table</span><span class="p">(</span><span class="n">iris2</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Area is greater than 20 square centimeters</span>
<span class="n">iris2</span><span class="p">[</span> <span class="n">Width</span> <span class="o">*</span> <span class="n">Length</span> <span class="o">&gt;</span> <span class="m">20</span> <span class="p">],</span> <span class="m">20</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>   Length Width    Species is_large
 1:    5.4   3.9     setosa    FALSE
 2:    5.8   4.0     setosa    FALSE
 3:    5.7   4.4     setosa     TRUE
 4:    5.4   3.9     setosa    FALSE
 5:    5.7   3.8     setosa    FALSE
 6:    5.2   4.1     setosa    FALSE
 7:    5.5   4.2     setosa    FALSE
 8:    7.0   3.2 versicolor    FALSE
 9:    6.4   3.2 versicolor    FALSE
10:    6.9   3.1 versicolor    FALSE
11:    6.3   3.3 versicolor    FALSE
12:    6.7   3.1 versicolor    FALSE
13:    6.7   3.0 versicolor    FALSE
14:    6.0   3.4 versicolor    FALSE
15:    6.7   3.1 versicolor    FALSE
16:    6.3   3.3  virginica    FALSE
17:    7.1   3.0  virginica    FALSE
18:    7.6   3.0  virginica    FALSE
19:    7.3   2.9  virginica    FALSE
20:    7.2   3.6  virginica     TRUE
...
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Add new boolean column</span>
<span class="n">iris2</span><span class="p">[,</span> <span class="n">is_large</span> <span class="o">:=</span> <span class="n">Width</span> <span class="o">*</span> <span class="n">Length</span> <span class="o">&gt;</span> <span class="m">25</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Now large observations with is_large</span>
<span class="n">iris2</span><span class="p">[</span><span class="n">is_large</span> <span class="o">==</span> <span class="kc">TRUE</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>   Length Width   Species is_large
1:    5.7   4.4    setosa     TRUE
2:    7.2   3.6 virginica     TRUE
3:    7.7   3.8 virginica     TRUE
4:    7.9   3.8 virginica     TRUE
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">iris2</span><span class="p">[(</span><span class="n">is_large</span><span class="p">)]</span> <span class="c1"># Also OK</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>   Length Width   Species is_large
1:    5.7   4.4    setosa     TRUE
2:    7.2   3.6 virginica     TRUE
3:    7.7   3.8 virginica     TRUE
4:    7.9   3.8 virginica     TRUE
</code></pre></div>
<h3 id="selecting-groups-or-parts-of-groups">Selecting groups or parts of groups<a class="headerlink" href="#selecting-groups-or-parts-of-groups" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># The &#39;keyed&#39; data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)],</span>
                 <span class="n">B</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span><span class="m">8</span> <span class="p">,</span><span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 <span class="n">C</span> <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">)</span>
<span class="nf">setkey</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

<span class="c1"># Select the &#39;b&#39; group</span>
<span class="n">DT</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B  C
## 1: b 1  8
## 2: b 5  6
## 3: b 8 11
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># &#39;b&#39; and &#39;c&#39; groups</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B  C
## 1: b 1  8
## 2: b 5  6
## 3: b 8 11
## 4: c 6 12
## 5: c 9  9
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># The first row of the &#39;b&#39; and &#39;c&#39; groups</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="n">mult</span> <span class="o">=</span> <span class="s">&#39;first&#39;</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B  C
## 1: b 1  8
## 2: c 6 12
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># First and last row of the &#39;b&#39; and &#39;c&#39; groups</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="n">.SD</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">.N</span><span class="p">)],</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.EACHI</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B  C
## 1: b 1  8
## 2: b 8 11
## 3: c 6 12
## 4: c 9  9
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Copy and extend code for instruction 4: add printout</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="n">.SD</span><span class="p">);</span> <span class="n">.SD</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">.N</span><span class="p">)]</span> <span class="p">},</span> <span class="n">by</span> <span class="o">=</span> <span class="n">.EACHI</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    B  C
## 1: 1  8
## 2: 5  6
## 3: 8 11
##    B  C
## 1: 6 12
## 2: 9  9

##    A B  C
## 1: b 1  8
## 2: b 8 11
## 3: c 6 12
## 4: c 9  9
</code></pre></div>
</td></tr></table>
<h3 id="rolling-joins">Rolling joins<a class="headerlink" href="#rolling-joins" title="Permanent link">&para;</a></h3>
<p><strong>Rolling joins &ndash; part one</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Keyed data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)],</span>                  <span class="n">B</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 <span class="n">C</span> <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> 
                 <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;A,B&#39;</span><span class="p">)</span>

<span class="c1"># Get the key of DT</span>
<span class="nf">key</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>## [1] &quot;A&quot; &quot;B&quot;
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Row where A == &#39;b&#39; &amp; B == 6</span>
<span class="nf">setkey</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="m">6</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B  C
## 1: b 6 NA
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Return the prevailing row</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> <span class="n">roll</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B C
## 1: b 6 6
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Return the nearest row</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> <span class="n">roll</span> <span class="o">=+</span> <span class="kc">Inf</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##    A B C
## 1: b 6 6
</code></pre></div>
</td></tr></table>
<p><strong>Rolling joins &ndash; part two</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Keyed data.table DT</span>
<span class="n">DT</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)],</span>                  <span class="n">B</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 <span class="n">C</span> <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> 
                 <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;A,B&#39;</span><span class="p">)</span>

<span class="c1"># Look at the sequence (-2):10 for the &#39;b&#39; group</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">)]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##     A  B  C
##  1: b -2 NA
##  2: b -1 NA
##  3: b  0 NA
##  4: b  1  8
##  5: b  2 NA
##  6: b  3 NA
##  7: b  4 NA
##  8: b  5  6
##  9: b  6 NA
## 10: b  7 NA
## 11: b  8 11
## 12: b  9 NA
## 13: b 10 NA
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Add code: carry the prevailing values forwards</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">),</span> <span class="n">roll</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##     A  B  C
##  1: b -2 NA
##  2: b -1 NA
##  3: b  0 NA
##  4: b  1  8
##  5: b  2  8
##  6: b  3  8
##  7: b  4  8
##  8: b  5  6
##  9: b  6  6
## 10: b  7  6
## 11: b  8 11
## 12: b  9 11
## 13: b 10 11
</code></pre></div>
</td></tr></table>
<div class="highlight"><pre><span></span><code><span class="c1"># Add code: carry the first observation backwards</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">),</span> <span class="n">roll</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">rollends</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">]</span>
</code></pre></div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>##     A  B  C
##  1: b -2  8
##  2: b -1  8
##  3: b  0  8
##  4: b  1  8
##  5: b  2  8
##  6: b  3  8
##  7: b  4  8
##  8: b  5  6
##  9: b  6  6
## 10: b  7  6
## 11: b  8 11
## 12: b  9 11
## 13: b 10 11
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../reading_data_into_r_with_readr/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Reading Data into R with readr" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Reading Data into R with readr
            </div>
          </div>
        </a>
      
      
        
        <a href="../data_manipulation_in_r_with_dplyr/" class="md-footer__link md-footer__link--next" aria-label="Next: Data Manipulation in R with dplyr" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Data Manipulation in R with dplyr
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.f8263e09.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4fc53ad4.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>